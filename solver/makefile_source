OBJ = kinds.o formats.o flow_types.o prun.o allocate_arrays.o par_file.o aux.o \
mpi_control.o matrix.o dmatrix.o rdmatrix.o cdmatrix.o vector.o lap_blk.o time.o \
solver.o main.o

OBJ_LIST = $(foreach O, ${OBJ}, $(OBJDIR)/$(O))

$(EXE) : $(OBJ_LIST)
	$(COMPILER) -o $(EXE) $(OBJ_LIST) $(LIBS) $(MT_FLAG)

################################### SOURCE FILES #########################################
$(OBJDIR)/kinds.o: $(SOURCE)/kinds.F90
	$(COMPILER) -c $(FLAGS) $< -o $@

$(OBJDIR)/formats.o: $(SOURCE)/formats.F90
	$(COMPILER) -c $(FLAGS) $< -o $@

$(OBJDIR)/flow_types.o: $(SOURCE)/flow_types.F90
	$(COMPILER) -c $(FLAGS) $< -o $@

$(OBJDIR)/prun.o: $(SOURCE)/prun.F90
	$(COMPILER) -c $(FLAGS) $< -o $@

$(OBJDIR)/allocate_arrays.o: $(SOURCE)/allocate_arrays/* $(OBJDIR)/kinds.o \
$(OBJDIR)/prun.o
	$(COMPILER) -c $(FLAGS) $(SOURCE)/allocate_arrays/allocate_arrays.F90 -o $@

$(OBJDIR)/par_file.o: $(SOURCE)/par_file.F90 $(OBJDIR)/prun.o $(OBJDIR)/kinds.o \
$(OBJDIR)/formats.o
	$(COMPILER) -c $(FLAGS) $< -o $@

$(OBJDIR)/aux.o: $(SOURCE)/aux.F90 $(OBJDIR)/allocate_arrays.o
	$(COMPILER) -c $(FLAGS) -D$(CMP_FLAG) $< -o $@

$(OBJDIR)/mpi_control.o: $(SOURCE)/mpi_control.F90 $(OBJDIR)/allocate_arrays.o \
$(OBJDIR)/par_file.o $(OBJDIR)/aux.o
	$(COMPILER) -c $(FLAGS) $< -o $@

$(OBJDIR)/matrix.o: $(SOURCE)/matrix/matrix.F90 $(OBJDIR)/mpi_control.o
	$(COMPILER) -c $(FLAGS) $< -o $@

$(OBJDIR)/dmatrix.o: $(SOURCE)/matrix/dmatrix.F90 $(OBJDIR)/matrix.o
	$(COMPILER) -c $(FLAGS) $< -o $@

$(OBJDIR)/rdmatrix.o: $(SOURCE)/matrix/rdmatrix.F90 $(OBJDIR)/dmatrix.o
	$(COMPILER) -c $(FLAGS) $< -o $@

$(OBJDIR)/cdmatrix.o: $(SOURCE)/matrix/cdmatrix.F90 $(OBJDIR)/dmatrix.o
	$(COMPILER) -c $(FLAGS) $< -o $@

$(OBJDIR)/vector.o: $(SOURCE)/matrix/vector.F90 $(OBJDIR)/matrix.o
	$(COMPILER) -c $(FLAGS) $< -o $@

$(OBJDIR)/lap_blk.o: $(SOURCE)/lap_blk.F90 $(OBJDIR)/rdmatrix.o $(OBJDIR)/cdmatrix.o \
$(OBJDIR)/vector.o $(OBJDIR)/flow_types.o
	$(COMPILER) -c $(FLAGS) $< -o $@

$(OBJDIR)/time.o: $(SOURCE)/time.F90 $(OBJDIR)/allocate_arrays.o \
$(OBJDIR)/par_file.o
	$(COMPILER) -c $(FLAGS) $< -o $@

$(OBJDIR)/solver.o: $(SOURCE)/solver.F90 $(OBJDIR)/lap_blk.o $(OBJDIR)/time.o
	$(COMPILER) -c $(FLAGS) $< -o $@

$(OBJDIR)/main.o: main.F90 $(OBJDIR)/solver.o
	$(COMPILER) -c $(FLAGS) $< -o $@
##########################################################################################